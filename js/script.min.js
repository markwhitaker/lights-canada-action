"use strict";$(function(){const t="#F0F0F0",o="#D0D0D0",i=["#FF0000","#F00000","#E00000","#D10000","#C20000"],r="Flag of {0}",e="Film poster for {0}",a="https://www.imdb.com/title/{0}/",n="https://www.justwatch.com/uk/movie/{0}",s="https://letterboxd.com/film/{0}/",l="https://www.rottentomatoes.com/m/{0}",c="https://en.wikipedia.org/wiki/{0}",f="https://www.youtube.com/watch?v={0}",m=Object.freeze({TITLE:{getCaption:v,getTip:k},STATE:{getCaption:k,getTip:v}}),p=Object.freeze({TITLE:t=>t.title.sortable(),TITLE_LENGTH:t=>t.title.length,STATE:t=>t.state,YEAR:t=>t.year});let u,g={},h=[],w=[];var d;function T(){(u=new jvm.Map({map:"ca_lcc",container:$("#map"),backgroundColor:t,zoomMin:.9,focusOn:{x:.5,y:.5,scale:.95},series:{regions:[{attribute:"fill"}]},onRegionClick:(t,e)=>E(e),onRegionTipShow:(t,e,o)=>{o=g[o];o&&e.text("{0}: {1} ({2})".format(o.state,o.title,o.year))}})).series.regions[0].setValues(function(){var t={};for(var e in u.regions)t[e]=g[e]?g[e].colour:o;return t}())}function b(){u&&(u.remove(),u=void 0)}function S(o,t,i){$(o).empty(),t.forEach(t=>{return $(o).append((e=t,t=i,$("<span></span>").addClass("filmButton").prop({title:t.getTip(e),style:"background-color: {0}".format(e.colour)}).text(t.getCaption(e)).click(()=>E(e.stateCode)).prepend($("<img/>").prop({src:e.flag,alt:r.format(e.state)}).on("error",function(){$(this).hide()}))));var e})}function k(t){return t.state}function v(t){return"{0} ({1})".format(t.title,t.year)}function L(t){$(t).addClass("selected").siblings().removeClass("selected")}function y(t){$(t).show().siblings().hide()}function E(t){t=g[t];t&&($("#filmState").text(t.state),$("#filmTitle").text(t.title),$("#filmYear").text(t.year),$("#filmStateFlag").prop({src:t.flag,alt:r.format(t.state)}),$("#filmImageContainer").toggleClass("defaultImage",!t.image),$("#filmImage").prop({src:t.image,alt:e.format(t.title)}).toggle(!!t.image),$("#filmOriginalTitle").text(t.originalTitle).toggle(!!t.originalTitle),C("#imdbLink",a,t.imdb),C("#letterboxdLink",s,t.letterboxd),C("#rottenTomatoesLink",l,t.rottenTomatoes),C("#wikipediaLink",c,t.wikipedia),C("#justwatchLink",n,t.justwatch),C("#trailerLink",f,t.trailer),C("#reviewLink",f,t.review),$("#filmReviewer").text(t.reviewer),$(".modal-header").css("background-color",t.colour),$("#filmDetailsModal").modal())}function C(t,e,o){$(t).prop({href:e.format(o)}).toggle(!!o)}$("a").prop("target","_blank"),$("#btnShowMap").click(()=>{L("#btnShowMap"),y("#sectionMap"),T()}),$("#btnShowListStates").click(()=>{L("#btnShowListStates"),y("#sectionListStates"),b()}),$("#btnShowListMovies").click(()=>{L("#btnShowListMovies"),y("#sectionListMovies"),b()}),$("#btnShowAbout").click(()=>{L("#btnShowAbout"),y("#sectionAbout"),b()}),$("#filmStateFlag").on({error:function(){$(this).hide()},load:function(){$(this).show()}}),d=()=>{T(),S("#listStates",h,m.STATE),S("#listMovies",w,m.TITLE)},h=[],w=[],g={},$.getJSON("data/films.json",t=>{t.forEach(t=>{var e;t.colour=(e=Math.floor(Math.random()*i.length),i[e]),g[t.stateCode]=t}),h=t.sortBy(p.STATE),w=t.slice().sortBy(p.TITLE),d()}),String.prototype.format=function(){let e=this;for(let t=0;t<arguments.length;t++)e=e.replace("{"+t+"}",arguments[t]);return e},String.prototype.sortable=function(){return this.replace(/^(A|The) /,"")},Array.prototype.sortBy=function(o){return this.sort(function(t,e){return o(t)<o(e)?-1:o(t)>o(e)?1:0})}});