"use strict";$(function(){function t(){$("a").prop("target","_blank"),$("#btnShowMap").click(()=>p()),$("#btnShowListStates").click(()=>u()),$("#btnShowListMovies").click(()=>f()),$("#btnShowAbout").click(()=>g()),$("#filmStateFlag").on({error:function(){$(this).hide()},load:function(){$(this).show()}})}function e(t){M=[],x=[],C={},$.getJSON("data/films.json",e=>{e.forEach(t=>{t.colour=w(),C[t.stateCode]=t}),M=e.sortBy(v.STATE),x=e.slice().sortBy(v.TITLE),t()})}function o(){E=new jvm.Map({map:"ca_lcc",container:$("#map"),backgroundColor:k,zoomMin:.9,focusOn:{x:.5,y:.5,scale:.95},series:{regions:[{attribute:"fill"}]},onRegionClick:(t,e)=>b(e),onRegionTipShow:(t,e,o)=>{const i=C[o];i&&e.text(`${i.state}: ${i.title} (${i.year})`)}}),E.series.regions[0].setValues(d())}function i(){E&&(E.remove(),E=void 0)}function n(){s("#listStates",M,y.STATE)}function r(){s("#listMovies",x,y.TITLE)}function s(t,e,o){$(t).empty(),e.forEach(e=>$(t).append(a(e,o)))}function a(t,e){return $("<span></span>").addClass("filmButton").prop({title:e.getTip(t),style:`background-color: ${t.colour}`}).text(e.getCaption(t)).click(()=>b(t.stateCode)).prepend($("<img/>").prop({src:t.flag,alt:T(t)}).on("error",function(){$(this).hide()}))}function l(t){return t.state}function c(t){return`${t.title} (${t.year})`}function p(){h("#btnShowMap"),m("#sectionMap"),o()}function u(){h("#btnShowListStates"),m("#sectionListStates"),i()}function f(){h("#btnShowListMovies"),m("#sectionListMovies"),i()}function g(){h("#btnShowAbout"),m("#sectionAbout"),i()}function h(t){$(t).addClass("selected").siblings().removeClass("selected")}function m(t){$(t).show().siblings().hide()}function d(){const t={};for(const e in E.regions)t[e]=C[e]?C[e].colour:S;return t}function w(){const t=Math.floor(Math.random()*L.length);return L[t]}function b(t){const e=C[t];e&&($("#filmState").text(e.state),$("#filmTitle").text(e.title),$("#filmYear").text(e.year),$("#filmStateFlag").prop({src:e.flag,alt:T(e)}),$("#filmImageContainer").toggleClass("defaultImage",!e.image),$("#filmImage").prop({src:e.image,alt:`Movie poster for ${e.title} (${e.year})`}).toggle(!!e.image),$("#filmOriginalTitle").text(e.originalTitle).toggle(!!e.originalTitle),$("#imdbLink").toggle(!!e.imdb).prop({href:`https://www.imdb.com/title/${e.imdb}/`}),$("#letterboxdLink").toggle(!!e.letterboxd).prop({href:`https://letterboxd.com/film/${e.letterboxd}/`}),$("#rottenTomatoesLink").toggle(!!e.rottenTomatoes).prop({href:`https://www.rottentomatoes.com/m/${e.rottenTomatoes}`}),$("#wikipediaLink").toggle(!!e.wikipedia).prop({href:`https://en.wikipedia.org/wiki/${e.wikipedia}`}),$("#justwatchLink").toggle(!!e.justwatch).prop({href:`https://www.justwatch.com/uk/movie/${e.justwatch}`}),$("#trailerLink").toggle(!!e.trailer).prop({href:`https://youtu.be/${e.trailer}`}),$("#reviewLink").toggle(!!e.review).prop({href:`https://youtu.be/${e.review}`}),$("#filmReviewer").text(e.reviewer),$(".modal-header").css("background-color",e.colour),$("#filmDetailsModal").modal())}function T(t){return`Flag of ${t.state}`}const k="#F0F0F0",S="#D0D0D0",L=["#FF0000","#F00000","#E00000","#D10000","#C20000"],y=Object.freeze({TITLE:{getCaption:c,getTip:l},STATE:{getCaption:l,getTip:c}}),v=Object.freeze({TITLE:t=>t.title.sortable(),TITLE_LENGTH:t=>t.title.length,STATE:t=>t.state,YEAR:t=>t.year});let E,C={},M=[],x=[];t(),e(()=>{o(),n(),r()}),String.prototype.sortable=function(){return this.replace(/^(A|The) /,"")},Array.prototype.sortBy=function(t){return this.sort(function(e,o){return t(e)<t(o)?-1:t(e)>t(o)?1:0})}});