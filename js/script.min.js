"use strict";$((function(){const t=["#FF0000","#F00000","#E00000","#D10000","#C20000"],e="https://www.youtube.com/watch?v={0}",o=Object.freeze({TITLE:{getCaption:p,getTip:m},STATE:{getCaption:m,getTip:p}}),i=Object.freeze({TITLE:function(t){return t.title.sortable()},TITLE_LENGTH:function(t){return t.title.length},STATE:function(t){return t.state},YEAR:function(t){return t.year}});let n,r={},a=[],l=[];var s;function c(){n=new jvm.Map({map:"ca_lcc",container:$("#map"),backgroundColor:"#f0f0f0",zoomMin:.9,focusOn:{x:.5,y:.5,scale:.95},series:{regions:[{attribute:"fill"}]},onRegionClick:function(t,e){d(e)},onRegionTipShow:function(t,e,o){let i=r[o];i&&e.text("{0}: {1} ({2})".format(i.state,i.title,i.year))}}),n.series.regions[0].setValues(function(){let t={};for(let e in n.regions)t[e]=r[e]?r[e].colour:"#d0d0d0";return t}())}function f(){n&&(n.remove(),n=void 0)}function u(t,e,o){$(t).empty(),e.forEach((function(e){$(t).append(function(t,e){return $("<span></span>").addClass("filmButton").prop({title:e.getTip(t),style:"background-color: {0}".format(t.colour)}).text(e.getCaption(t)).click((function(){d(t.stateCode)})).prepend($("<img/>").prop({src:t.flag,alt:"Flag of {0}".format(t.state)}).on("error",(function(){$(this).hide()})))}(e,o))}))}function m(t){return t.state}function p(t){return"{0} ({1})".format(t.title,t.year)}function g(t){$(t).addClass("selected").siblings().removeClass("selected")}function h(t){$(t).show().siblings().hide()}function d(t){let o=r[t];o&&($("#filmState").text(o.state),$("#filmTitle").text(o.title),$("#filmYear").text(o.year),$("#filmStateFlag").prop({src:o.flag,alt:"Flag of {0}".format(o.state)}),$("#filmImageContainer").toggleClass("defaultImage",!o.image),$("#filmImage").prop({src:o.image,alt:"Film poster for {0}".format(o.title)}).toggle(!!o.image),$("#filmOriginalTitle").text(o.originalTitle).toggle(!!o.originalTitle),w("#imdbLink","https://www.imdb.com/title/{0}/",o.imdb),w("#letterboxdLink","https://letterboxd.com/film/{0}/",o.letterboxd),w("#rottenTomatoesLink","https://www.rottentomatoes.com/m/{0}",o.rottenTomatoes),w("#wikipediaLink","https://en.wikipedia.org/wiki/{0}",o.wikipedia),w("#justwatchLink","https://www.justwatch.com/uk/movie/{0}",o.justwatch),w("#trailerLink",e,o.trailer),w("#reviewLink",e,o.review),$("#filmReviewer").text(o.reviewer),$(".modal-header").css("background-color",o.colour),$("#filmDetailsModal").modal())}function w(t,e,o){$(t).prop({href:e.format(o)}).toggle(!!o)}$("a").prop("target","_blank"),$("#btnShowMap").click((function(){g("#btnShowMap"),h("#sectionMap"),c()})),$("#btnShowListStates").click((function(){g("#btnShowListStates"),h("#sectionListStates"),f()})),$("#btnShowListMovies").click((function(){g("#btnShowListMovies"),h("#sectionListMovies"),f()})),$("#btnShowAbout").click((function(){g("#btnShowAbout"),h("#sectionAbout"),f()})),$("#filmStateFlag").on({error:function(){$(this).hide()},load:function(){$(this).show()}}),s=function(){$("#filmCount").text(a.length),$("#filmCountCaption").text(1===a.length?"film":"films"),c(),u("#listStates",a,o.STATE),u("#listMovies",l,o.TITLE)},a=[],l=[],r={},$.getJSON("data/films.json",(function(e){e.forEach((function(e){e.colour=function(){let e=Math.floor(Math.random()*t.length);return t[e]}(),r[e.stateCode]=e})),a=e.sortBy(i.STATE),l=e.slice().sortBy(i.TITLE),s()})),String.prototype.format=function(){let t=this;for(let e=0;e<arguments.length;e++)t=t.replace("{"+e+"}",arguments[e]);return t},String.prototype.sortable=function(){return this.replace(/^(A|The) /,"")},Array.prototype.sortBy=function(t){return this.sort((function(e,o){return t(e)<t(o)?-1:t(e)>t(o)?1:0}))}}));