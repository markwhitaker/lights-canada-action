"use strict";$(function(){const t="#F0F0F0",o="#D0D0D0",i=["#FF0000","#F00000","#E00000","#D10000","#C20000"],e=Object.freeze({TITLE:{getCaption:h,getTip:u},STATE:{getCaption:u,getTip:h}}),r=Object.freeze({TITLE:t=>t.title.sortable(),TITLE_LENGTH:t=>t.title.length,STATE:t=>t.state,YEAR:t=>t.year});let n,a={},l=[],s=[];var c;function p(){(n=new jvm.Map({map:"ca_lcc",container:$("#map"),backgroundColor:t,zoomMin:.9,focusOn:{x:.5,y:.5,scale:.95},series:{regions:[{attribute:"fill"}]},onRegionClick:(t,e)=>w(e),onRegionTipShow:(t,e,o)=>{o=a[o];o&&e.text(`${o.state}: ${o.title} (${o.year})`)}})).series.regions[0].setValues(function(){var t={};for(var e in n.regions)t[e]=a[e]?a[e].colour:o;return t}())}function g(){n&&(n.remove(),n=void 0)}function f(o,t,i){$(o).empty(),t.forEach(t=>{return $(o).append((e=t,t=i,$("<span></span>").addClass("filmButton").prop({title:t.getTip(e),style:"background-color: "+e.colour}).text(t.getCaption(e)).click(()=>w(e.stateCode)).prepend($("<img/>").prop({src:e.flag,alt:b(e)}).on("error",function(){$(this).hide()}))));var e})}function u(t){return t.state}function h(t){return`${t.title} (${t.year})`}function m(t){$(t).addClass("selected").siblings().removeClass("selected")}function d(t){$(t).show().siblings().hide()}function w(t){t=a[t];t&&($("#filmState").text(t.state),$("#filmTitle").text(t.title),$("#filmYear").text(t.year),$("#filmStateFlag").prop({src:t.flag,alt:b(t)}),$("#filmImageContainer").toggleClass("defaultImage",!t.image),$("#filmImage").prop({src:t.image,alt:`Movie poster for ${t.title} (${t.year})`}).toggle(!!t.image),$("#filmOriginalTitle").text(t.originalTitle).toggle(!!t.originalTitle),$("#imdbLink").toggle(!!t.imdb).prop({href:`https://www.imdb.com/title/${t.imdb}/`}),$("#letterboxdLink").toggle(!!t.letterboxd).prop({href:`https://letterboxd.com/film/${t.letterboxd}/`}),$("#rottenTomatoesLink").toggle(!!t.rottenTomatoes).prop({href:"https://www.rottentomatoes.com/m/"+t.rottenTomatoes}),$("#wikipediaLink").toggle(!!t.wikipedia).prop({href:"https://en.wikipedia.org/wiki/"+t.wikipedia}),$("#justwatchLink").toggle(!!t.justwatch).prop({href:"https://www.justwatch.com/uk/movie/"+t.justwatch}),$("#trailerLink").toggle(!!t.trailer).prop({href:"https://youtu.be/"+t.trailer}),$("#reviewLink").toggle(!!t.review).prop({href:"https://youtu.be/"+t.review}),$("#filmReviewer").text(t.reviewer),$(".modal-header").css("background-color",t.colour),$("#filmDetailsModal").modal())}function b(t){return"Flag of "+t.state}$("a").prop("target","_blank"),$("#btnShowMap").click(()=>{m("#btnShowMap"),d("#sectionMap"),p()}),$("#btnShowListStates").click(()=>{m("#btnShowListStates"),d("#sectionListStates"),g()}),$("#btnShowListMovies").click(()=>{m("#btnShowListMovies"),d("#sectionListMovies"),g()}),$("#btnShowAbout").click(()=>{m("#btnShowAbout"),d("#sectionAbout"),g()}),$("#filmStateFlag").on({error:function(){$(this).hide()},load:function(){$(this).show()}}),c=()=>{p(),f("#listStates",l,e.STATE),f("#listMovies",s,e.TITLE)},l=[],s=[],a={},$.getJSON("data/films.json",t=>{t.forEach(t=>{var e;t.colour=(e=Math.floor(Math.random()*i.length),i[e]),a[t.stateCode]=t}),l=t.sortBy(r.STATE),s=t.slice().sortBy(r.TITLE),c()}),String.prototype.sortable=function(){return this.replace(/^(A|The) /,"")},Array.prototype.sortBy=function(o){return this.sort(function(t,e){return o(t)<o(e)?-1:o(t)>o(e)?1:0})}});